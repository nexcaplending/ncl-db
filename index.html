<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NexCap Command Center</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
}

.container {
  padding:40px;
}

.title {
  font-size:32px;
  font-weight:bold;
}

.cards {
  display:flex;
  gap:20px;
  margin-top:30px;
}

.card {
  flex:1;
  background:rgba(255,255,255,0.08);
  padding:25px;
  border-radius:12px;
  text-align:center;
}

.big {
  font-size:48px;
  font-weight:bold;
  margin-top:10px;
}

table {
  width:100%;
  margin-top:40px;
  border-collapse:collapse;
}

th, td {
  padding:12px;
  text-align:left;
}

th {
  background:rgba(255,255,255,0.1);
}

tr:nth-child(even) {
  background:rgba(255,255,255,0.05);
}
</style>
</head>

<body>
<div class="container">
  <div class="title">NexCap Command Center</div>
  <div id="updated"></div>

  <div class="cards">
    <div class="card">
      <div>Closed YTD</div>
      <div class="big" id="closed">0</div>
    </div>

    <div class="card">
      <div>Awaiting CTC</div>
      <div class="big" id="awaiting">0</div>
    </div>

    <div class="card">
      <div>Clearing Conditions</div>
      <div class="big" id="clearing">0</div>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Borrower</th>
        <th>Loan Amount</th>
        <th>Status</th>
        <th>Closing</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
</div>

<script>
async function loadData(){
  const res = await fetch('data.json?ts=' + Date.now());
  const data = await res.json();

  document.getElementById("updated").innerText =
    "Updated: " + data.updated_at;

  document.getElementById("closed").innerText =
    data.closed_ytd;

  document.getElementById("awaiting").innerText =
    data.status_counts["Awaiting CTC"];

  document.getElementById("clearing").innerText =
    data.status_counts["Clearing Conditions"];

  const tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  data.rows.forEach(r => {
    tbody.innerHTML += `
      <tr>
        <td>${r.borrower}</td>
        <td>${r.loan_amount}</td>
        <td>${r.status}</td>
        <td>${r.closing_date}</td>
      </tr>
    `;
  });
}

loadData();
setInterval(loadData, 15000);
</script>

</body>
</html>
